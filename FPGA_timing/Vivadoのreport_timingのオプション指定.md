## USER
Vivadoでreport_timingコマンドをGUIで実行する際、TargetsタブでStart Points、Through Points、End Pointsの3箇所に入力することができます。

例えば途中にレジスタがなく、入力ポートから出力ポートまでの遅延を出力させたい場合には、Through Pointsに入力ポート名、End Pointsに出力ポート名を設定すると入力ポートから出力ポートへの遅延を表示することができました。

この使い方は正しいのでしょうか？

## ASSISTANT
はい、その使い方は**正しい**です。Vivadoの `report_timing` コマンドのGUIにおける **Start Points / Through Points / End Points** の設定は、タイミングパスの抽出範囲を制御するためのものです。

---

### 【目的】
入力ポートから出力ポートまで、**途中にレジスタが存在しない**コンビネーショナルパスの遅延を調べたい。

---

### 【設定の正当性】

- **Start Points**：通常はレジスタやクロック入力などを指定しますが、今回は「未指定」にしておくことで、Vivadoは可能なすべてのスタートポイントを対象とします。
- **Through Points**：入力ポート（例：`in_signal`）を指定すると、Vivadoはその信号を**通過する**パスを探索対象とします。
- **End Points**：出力ポート（例：`out_signal`）を指定することで、**そのポートに至るパス**が出力されます。

→ このように設定することで、「`in_signal`から出発して、`out_signal`で終わるパス」のうち、**コンビネーショナルパス（途中にレジスタなし）**の遅延を報告することができます。

---

### 【補足】
- この手法は **入出力間の純粋な遅延（例えばI/OバッファやLUT遅延）を確認したい** 場合に有効です。
- 結果として表示されるパスにクロック情報がなければ、それは「**クロック非依存のコンビネーショナルパス**」です。

---

### 【コマンドベースの等価な記述（参考）】
```tcl
report_timing -through [get_ports in_signal] -to [get_ports out_signal]
```

これはGUIでThrough Pointsに`in_signal`、End Pointsに`out_signal`を設定したのと同じ意味になります。

---

### 【注意点】
- 一見レジスタがないように見えても、合成後にVivadoが最適化で挿入しているケースもあるため、**タイミングレポートに "reg" などの要素が混ざっていないか確認**すると確実です。
- `report_timing` は最大遅延をレポートしますが、`-min` オプションを使えば最小遅延（ホールドマージン確認など）も見られます。

---

ご質問の使い方は正しく、VivadoでのI/O間タイミング確認としてよく使われる方法の一つです。

## USER
入力ポート、出力ポートを複数指定すると、入出力の全組み合わせについて遅延を出力することが出来ると考えてよろしいでしょうか？

## ASSISTANT
はい、その理解で**概ね正しい**です。

Vivadoで `report_timing` をGUIまたはTclコマンドで実行する際に、**複数の入力ポート・出力ポートを指定**すると、Vivadoは以下のように動作します：

---

### 【挙動の概要】

- `Through Points` に複数の**入力ポート**（例：`in1`, `in2`, `in3`）  
- `End Points` に複数の**出力ポート**（例：`out1`, `out2`）

この場合、Vivadoは次のような **全ての組み合わせ**に対する遅延パスを報告対象とします：

```
in1 → out1  
in1 → out2  
in2 → out1  
in2 → out2  
in3 → out1  
in3 → out2  
...（合計：入力ポート数 × 出力ポート数）
```

---

### 【ただし注意点】

- Vivadoは**存在する有効なパス**のみをレポートします。
  - 物理的に接続がない、または途中で遮断されているパス（たとえば `in2` → `out3` が存在しない）は**スキップ**されます。
- デフォルトでは最大20件（`-max_paths 20`）までしかレポートされないので、**全パスを確認したい場合はこの上限を増やす必要**があります。

---

### 【Tclでの記述例】

```tcl
report_timing -through [get_ports {in1 in2 in3}] -to [get_ports {out1 out2 out3}] -max_paths 100
```

---

### 【GUIでの指定時のヒント】

- `Through Points` と `End Points` に複数のポートを列挙することで、GUIでも同様に全組み合わせが対象になります。
- `Start Points` を空欄にすれば、Vivadoは自動的に始点を推測し、`Through` → `End` のパスを探します。

---

### 【補足】

- 明示的に「入力ポートから出力ポートへの**組み合わせごとの遅延**」を一覧で取りたい場合は、VivadoレポートをCSV形式でエクスポートしたり、Tclスクリプトでループ処理して個別に `report_timing` を実行しても良いです。

---

ご要望に応じて、そのようなTclスクリプトのサンプルもご用意できますので、必要でしたらお申し付けください。

## USER
存在するすべての組み合わせで遅延を表示する、とのことで承知しました。

最初の質問に戻るのですが、組み合わせ回路の遅延を出力する場合、入力ポートをStart PointsではなくThrough Pointsにする直感的に理解できないです。

なにか理由があってこのような仕様になっているのでしょうか？

## ASSISTANT
とても鋭いご指摘です。たしかに直感的には「入力ポート＝Start Point」であるべきように感じますが、Vivadoで**入力ポートをStart PointではなくThrough Pointに指定する方が有効に働く**のは、Vivadoのタイミング解析エンジンの仕様と目的が関係しています。

以下、理由を丁寧に分解して説明します。

---

## 【なぜStart Pointに入力ポートを指定しないのか？】

Vivadoの `report_timing` の本質的な動作は、「**クロックドパス**（クロック起点→クロック終点）に沿って**setup/hold**などをチェックする」ために設計されています。

### 1. **Start Pointの本来の役割**
Vivadoが想定するStart Pointとは：

- **クロックに同期した出発点**（レジスタの出力、RAMの出力など）
- そこからクロック遅延・データ遅延を伝播させてチェックする

つまりVivadoでは「Start Pointに**非同期の入力ポート**を直接指定すると、意味のある解析対象として扱われない」ことがあります。

---

### 2. **Through Pointを使うとVivadoは「通過パス」を探す**
`-through` にポートを指定すると、Vivadoは

- 「この信号を**通過するすべてのタイミングパス**」を対象にして
- 自動的にクロック同期／非同期含めた関連パスを探索

このため、**入力ポート→出力ポートの組み合わせ回路の遅延**のように、**クロックとは無関係なパス**を調べたいときに、`-through` の指定が最も適しています。

---

## 【Vivadoがこの仕様にした理由（推測含む）】

- Vivadoは「**クロック起点の遅延制約検証**」を主眼としている
  - 例：setup/hold、clock-to-out、input delay、output delay など
- 入力ポートはクロックとは無関係な信号源であり、**Start Pointにしても有効なタイミングパスに紐付けにくい**
- 一方、**through指定にすることで内部パスの一部としての遅延を抽出できる**

つまり、「**レジスタのない組み合わせ回路の遅延を見る＝Vivado本来の用途外のことをさせている**」とも言えます。

---

## 【結論】

| 観点 | Throughに入力を使う理由 |
|------|--------------------------|
| Vivadoの設計 | クロック起点の解析が基本 |
| 入出力遅延の測定 | 組み合わせ回路パスを抽出するには `-through` の方が柔軟で成功しやすい |
| Start Pointに入力を指定 | 実際には有効なパスと認識されないことが多い（クロックの起点が不明） |

---

## 【補足】

もちろん、`set_input_delay` などの制約を適切に与えた状態で、入力ポートをStart Pointに指定してもVivadoがうまく解釈できる場合もあります。ただし、**確実に対象パスを引き出したいときにはThrough指定が確実**です。

---

必要であれば、「Start Pointに指定した場合どうなるかの具体例」も交えてご説明できます。ご希望あればお知らせください。

## USER
レジスタからレジスタの遅延を出力するにはStart PointsとEnd Pointsのみを指定すればよいのでしょうか？

レジスタから出力ポートまでの遅延を出力するにはStart PointsとEnd Pointsを指定すべきでしょうか？それともStart PointsとThrough Pointsを指定すべきでしょうか？

また、Start Points、Through Points、End Pointsの3つを指定するようなケースはありますか？

## ASSISTANT
非常に良いご質問です。Vivadoの `report_timing` における **Start Points / Through Points / End Points の使い分け**はタイミングパスの抽出において重要で、それぞれの組み合わせには明確な意味と使いどころがあります。

以下にケースごとに丁寧に説明します。

---

## 【1. レジスタ → レジスタ の遅延を出力したい】

### ● 設定
- **Start Points**：始点となるレジスタ（例：`get_cells -hier -filter {NAME =~ "u_reg_a"}`）
- **End Points**：終点となるレジスタ（例：`get_cells -hier -filter {NAME =~ "u_reg_b"}`）
- **Through Points**：未指定（不要）

### ● 理由
この場合、Vivadoは正しくクロックドパスを認識できるので、StartとEndだけで十分です。

---

## 【2. レジスタ → 出力ポート の遅延を出力したい】

### ● 推奨設定
- **Start Points**：出発レジスタ
- **End Points**：出力ポート（例：`get_ports OUT_SIG`）
- **Through Points**：**指定しなくてもOK**

### ● 補足
- `report_timing` は Start → End の**最大遅延パス**を自動で探索します。
- 出力ポートに至るパスが複数あった場合、**最大遅延のもののみが表示される**ため、複数確認したいときは `-max_paths` を使います。

---

## 【3. Start Points + Through Points を使うケース】

### ● 目的
- レジスタ → 任意の中間信号（例：バスやモジュール内ワイヤ）を通るパスを調べたい

### ● 設定
- **Start Points**：始点のレジスタ
- **Through Points**：通過してほしい配線（例：バス）
- **End Points**：指定しないか、限定したい出力／レジスタを指定

### ● 効果
- ある特定の経路だけに絞って、不要なパスを除外した解析が可能

---

## 【4. Start + Through + End の3つをすべて使うケース】

### ● ケース例：
「レジスタAからレジスタBまでの間に、**必ず特定のモジュールの内部信号（またはインスタンス）を通過する**」パスの遅延を知りたい。

### ● 設定例：
```tcl
report_timing \
  -from [get_cells u_reg_a] \
  -through [get_nets u_logic_module/data_bus*] \
  -to [get_cells u_reg_b]
```

### ● 効果：
- 特定のロジック（例：暗号化モジュール、加算器など）を通ったパスだけを抽出可能。
- **パフォーマンスのボトルネック特定や、フォーマル検証とのリンク**にも便利。

---

## 【まとめ：指定パターンと用途】

| 指定方法                    | 用途の代表例                               |
|----------------------------|--------------------------------------------|
| Start + End                | レジスタ → レジスタ、レジスタ → 出力ポート |
| Start + Through            | レジスタ → 特定の中間信号経由              |
| Through + End              | 入力ポート → 出力ポート（レジスタなし）     |
| Start + Through + End      | 経路に制限をかけたパス抽出（詳細調査）      |

---

ご希望があれば、上記のいずれかについて **具体的なTclコマンド例**や **GUI操作例** もご紹介できますので、お気軽にお申し付けください。

## USER
report_timingのStart points/Through poitns/End pointsの3つの指定方法について理解が深まりました。ありがとうございました。

## ASSISTANT
どういたしまして！ご質問の内容がとても的確だったので、深い話までできてこちらも嬉しかったです。

Vivadoの `report_timing` は指定の仕方次第で見える情報が大きく変わるので、今回のように **目的に応じてStart/Through/Endをどう使い分けるか** をしっかり理解されているのは非常に大きな強みです。

また何かタイミング解析やVivado関連で疑問があれば、いつでも聞いてください！